<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asapi: vendor/ImGuiFileDialog/3rdparty/imgui/misc/freetype/imgui_freetype.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asapi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c5da75fdc1d6c57999112ed830c87a3c.html">vendor</a></li><li class="navelem"><a class="el" href="dir_d1647b87dbdd03f006d1338b34a90efa.html">ImGuiFileDialog</a></li><li class="navelem"><a class="el" href="dir_58bf3521440f8a95f5d8f3fa48a4fb03.html">3rdparty</a></li><li class="navelem"><a class="el" href="dir_6617867c5592e3cce7586c3971ff0a0e.html">imgui</a></li><li class="navelem"><a class="el" href="dir_7272a238809061e80e6da6a946fc37bd.html">misc</a></li><li class="navelem"><a class="el" href="dir_1daf04899b60ce3d6d12c5bd6168aacd.html">freetype</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">imgui_freetype.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// dear imgui: wrapper to use FreeType (instead of stb_truetype)</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Get latest version at https://github.com/ocornut/imgui/tree/master/misc/freetype</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Original code by @vuhdo (Aleksei Skriabin). Improvements by @mikesart. Maintained and v0.60+ by @ocornut.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Changelog:</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// - v0.50: (2017/08/16) imported from https://github.com/Vuhdo/imgui_freetype into http://www.github.com/ocornut/imgui_club, updated for latest changes in ImFontAtlas, minor tweaks.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// - v0.51: (2017/08/26) cleanup, optimizations, support for ImFontConfig::RasterizerFlags, ImFontConfig::RasterizerMultiply.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// - v0.52: (2017/09/26) fixes for imgui internal changes.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// - v0.53: (2017/10/22) minor inconsequential change to match change in master (removed an unnecessary statement).</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// - v0.54: (2018/01/22) fix for addition of ImFontAtlas::TexUvscale member.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// - v0.55: (2018/02/04) moved to main imgui repository (away from http://www.github.com/ocornut/imgui_club)</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// - v0.56: (2018/06/08) added support for ImFontConfig::GlyphMinAdvanceX, GlyphMaxAdvanceX.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// - v0.60: (2019/01/10) re-factored to match big update in STB builder. fixed texture height waste. fixed redundant glyphs when merging. support for glyph padding.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// - v0.61: (2019/01/15) added support for imgui allocators + added FreeType only override function SetAllocatorFunctions().</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// - v0.62: (2019/02/09) added RasterizerFlags::Monochrome flag to disable font anti-aliasing (combine with ::MonoHinting for best results!)</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// - v0.63: (2020/06/04) fix for rare case where FT_Get_Char_Index() succeed but FT_Load_Glyph() fails.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// Gamma Correct Blending:</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//  FreeType assumes blending in linear space rather than gamma space.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//  See https://www.freetype.org/freetype2/docs/reference/ft2-base_interface.html#FT_Render_Glyph</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//  For correct results you need to be using sRGB and convert to linear space in the pixel shader output.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//  The default imgui styles will be impacted by this change (alpha values will need tweaking).</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// FIXME: cfg.OversampleH, OversampleV are not supported (but perhaps not so necessary with this rasterizer).</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;imgui_freetype.h&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;imgui_internal.h&quot;</span>     <span class="comment">// ImMin,ImMax,ImFontAtlasBuild*,</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;ft2build.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include FT_FREETYPE_H          </span><span class="comment">// &lt;freetype/freetype.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include FT_MODULE_H            </span><span class="comment">// &lt;freetype/ftmodapi.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include FT_GLYPH_H             </span><span class="comment">// &lt;freetype/ftglyph.h&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include FT_SYNTHESIS_H         </span><span class="comment">// &lt;freetype/ftsynth.h&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#pragma warning (disable: 4505) </span><span class="comment">// unreferenced local function has been removed (stb stuff)</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#if defined(__GNUC__)</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wpragmas&quot;</span>                  <span class="comment">// warning: unknown option after &#39;#pragma GCC diagnostic&#39; kind</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wunused-function&quot;</span>          <span class="comment">// warning: &#39;xxxx&#39; defined but not used</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">namespace</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// Glyph metrics:</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// --------------</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">//                       xmin                     xmax</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">//                        |                         |</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">//                        |&lt;-------- width --------&gt;|</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">//                        |                         |</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">//              |         +-------------------------+----------------- ymax</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">//              |         |    ggggggggg   ggggg    |     ^        ^</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">//              |         |   g:::::::::ggg::::g    |     |        |</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">//              |         |  g:::::::::::::::::g    |     |        |</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">//              |         | g::::::ggggg::::::gg    |     |        |</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">//              |         | g:::::g     g:::::g     |     |        |</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">//    offsetX  -|--------&gt;| g:::::g     g:::::g     |  offsetY     |</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">//              |         | g:::::g     g:::::g     |     |        |</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">//              |         | g::::::g    g:::::g     |     |        |</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">//              |         | g:::::::ggggg:::::g     |     |        |</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">//              |         |  g::::::::::::::::g     |     |      height</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">//              |         |   gg::::::::::::::g     |     |        |</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">//  baseline ---*---------|---- gggggggg::::::g-----*--------      |</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">//            / |         |             g:::::g     |              |</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">//     origin   |         | gggggg      g:::::g     |              |</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">//              |         | g:::::gg   gg:::::g     |              |</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">//              |         |  g::::::ggg:::::::g     |              |</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">//              |         |   gg:::::::::::::g      |              |</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">//              |         |     ggg::::::ggg        |              |</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">//              |         |         gggggg          |              v</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">//              |         +-------------------------+----------------- ymin</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">//              |                                   |</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">//              |------------- advanceX -----------&gt;|</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">struct </span>GlyphInfo</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordtype">int</span>         Width;              <span class="comment">// Glyph&#39;s width in pixels.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordtype">int</span>         Height;             <span class="comment">// Glyph&#39;s height in pixels.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        FT_Int      OffsetX;            <span class="comment">// The distance from the origin (&quot;pen position&quot;) to the left of the glyph.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        FT_Int      OffsetY;            <span class="comment">// The distance from the origin to the top of the glyph. This is usually a value &lt; 0.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordtype">float</span>       AdvanceX;           <span class="comment">// The distance from the origin to the origin of the next glyph. This is usually a value &gt; 0.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    };</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// Font parameters and metrics.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keyword">struct </span>FontInfo</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        uint32_t    PixelHeight;        <span class="comment">// Size this font was generated with.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordtype">float</span>       Ascender;           <span class="comment">// The pixel extents above the baseline in pixels (typically positive).</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordtype">float</span>       Descender;          <span class="comment">// The extents below the baseline in pixels (typically negative).</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordtype">float</span>       LineSpacing;        <span class="comment">// The baseline-to-baseline distance. Note that it usually is larger than the sum of the ascender and descender taken as absolute values. There is also no guarantee that no glyphs extend above or below subsequent baselines when using this distance. Think of it as a value the designer of the font finds appropriate.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordtype">float</span>       LineGap;            <span class="comment">// The spacing in pixels between one row&#39;s descent and the next row&#39;s ascent.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordtype">float</span>       MaxAdvanceWidth;    <span class="comment">// This field gives the maximum horizontal cursor advance for all glyphs in the font.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    };</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// FreeType glyph rasterizer.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// NB: No ctor/dtor, explicitly call Init()/Shutdown()</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keyword">struct </span>FreeTypeFont</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordtype">bool</span>                    InitFont(FT_Library ft_library, <span class="keyword">const</span> <a class="code" href="structImFontConfig.html">ImFontConfig</a>&amp; cfg, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extra_user_flags); <span class="comment">// Initialize from an external data buffer. Doesn&#39;t copy data, and you must ensure it stays valid up to this object lifetime.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordtype">void</span>                    CloseFont();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordtype">void</span>                    SetPixelHeight(<span class="keywordtype">int</span> pixel_height); <span class="comment">// Change font pixel size. All following calls to RasterizeGlyph() will use this size</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">const</span> FT_Glyph_Metrics* LoadGlyph(uint32_t in_codepoint);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">const</span> FT_Bitmap*        RenderGlyphAndGetInfo(GlyphInfo* out_glyph_info);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordtype">void</span>                    BlitGlyph(<span class="keyword">const</span> FT_Bitmap* ft_bitmap, uint8_t* dst, uint32_t dst_pitch, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* multiply_table = NULL);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        ~FreeTypeFont()         { CloseFont(); }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">// [Internals]</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        FontInfo        Info;               <span class="comment">// Font descriptor of the current font.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        FT_Face         Face;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    UserFlags;          <span class="comment">// = ImFontConfig::RasterizerFlags</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        FT_Int32        LoadFlags;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        FT_Render_Mode  RenderMode;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    };</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// From SDL_ttf: Handy routines for converting from fixed point</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">    #define FT_CEIL(X)  (((X + 63) &amp; -64) / 64)</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">bool</span> FreeTypeFont::InitFont(FT_Library ft_library, <span class="keyword">const</span> <a class="code" href="structImFontConfig.html">ImFontConfig</a>&amp; cfg, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extra_user_flags)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        FT_Error error = FT_New_Memory_Face(ft_library, (uint8_t*)cfg.FontData, (uint32_t)cfg.FontDataSize, (uint32_t)cfg.FontNo, &amp;Face);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">if</span> (error != 0)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        error = FT_Select_Charmap(Face, FT_ENCODING_UNICODE);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> (error != 0)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        memset(&amp;Info, 0, <span class="keyword">sizeof</span>(Info));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        SetPixelHeight((uint32_t)cfg.SizePixels);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">// Convert to FreeType flags (NB: Bold and Oblique are processed separately)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        UserFlags = cfg.RasterizerFlags | extra_user_flags;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        LoadFlags = FT_LOAD_NO_BITMAP;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::NoHinting)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            LoadFlags |= FT_LOAD_NO_HINTING;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::NoAutoHint)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            LoadFlags |= FT_LOAD_NO_AUTOHINT;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::ForceAutoHint)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            LoadFlags |= FT_LOAD_FORCE_AUTOHINT;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::LightHinting)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            LoadFlags |= FT_LOAD_TARGET_LIGHT;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::MonoHinting)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            LoadFlags |= FT_LOAD_TARGET_MONO;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            LoadFlags |= FT_LOAD_TARGET_NORMAL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::Monochrome)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            RenderMode = FT_RENDER_MODE_MONO;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            RenderMode = FT_RENDER_MODE_NORMAL;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">void</span> FreeTypeFont::CloseFont()</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span> (Face)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            FT_Done_Face(Face);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            Face = NULL;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">void</span> FreeTypeFont::SetPixelHeight(<span class="keywordtype">int</span> pixel_height)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// Vuhdo: I&#39;m not sure how to deal with font sizes properly. As far as I understand, currently ImGui assumes that the &#39;pixel_height&#39;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// is a maximum height of an any given glyph, i.e. it&#39;s the sum of font&#39;s ascender and descender. Seems strange to me.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// NB: FT_Set_Pixel_Sizes() doesn&#39;t seem to get us the same result.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        FT_Size_RequestRec req;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        req.type = FT_SIZE_REQUEST_TYPE_REAL_DIM;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        req.width = 0;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        req.height = (<a class="code" href="group__gtc__type__precision.html#ga822ca53a9ad412504532838906276a99">uint32_t</a>)pixel_height * 64;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        req.horiResolution = 0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        req.vertResolution = 0;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        FT_Request_Size(Face, &amp;req);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">// Update font info</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        FT_Size_Metrics metrics = Face-&gt;size-&gt;metrics;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        Info.PixelHeight = (<a class="code" href="group__gtc__type__precision.html#ga822ca53a9ad412504532838906276a99">uint32_t</a>)pixel_height;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        Info.Ascender = (float)FT_CEIL(metrics.ascender);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        Info.Descender = (float)FT_CEIL(metrics.descender);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        Info.LineSpacing = (float)FT_CEIL(metrics.height);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        Info.LineGap = (float)FT_CEIL(metrics.height - metrics.ascender + metrics.descender);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        Info.MaxAdvanceWidth = (float)FT_CEIL(metrics.max_advance);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">const</span> FT_Glyph_Metrics* FreeTypeFont::LoadGlyph(uint32_t codepoint)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        uint32_t glyph_index = FT_Get_Char_Index(Face, codepoint);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> (glyph_index == 0)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        FT_Error error = FT_Load_Glyph(Face, glyph_index, LoadFlags);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">if</span> (error)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// Need an outline for this to work</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        FT_GlyphSlot slot = Face-&gt;glyph;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        IM_ASSERT(slot-&gt;format == FT_GLYPH_FORMAT_OUTLINE);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// Apply convenience transform (this is not picking from real &quot;Bold&quot;/&quot;Italic&quot; fonts! Merely applying FreeType helper transform. Oblique == Slanting)</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::Bold)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            FT_GlyphSlot_Embolden(slot);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> (UserFlags &amp; ImGuiFreeType::Oblique)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            FT_GlyphSlot_Oblique(slot);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">//FT_BBox bbox;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="comment">//FT_Outline_Get_BBox(&amp;slot-&gt;outline, &amp;bbox);</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment">//slot-&gt;metrics.width = bbox.xMax - bbox.xMin;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="comment">//slot-&gt;metrics.height = bbox.yMax - bbox.yMin;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> &amp;slot-&gt;metrics;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keyword">const</span> FT_Bitmap* FreeTypeFont::RenderGlyphAndGetInfo(GlyphInfo* out_glyph_info)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        FT_GlyphSlot slot = Face-&gt;glyph;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        FT_Error error = FT_Render_Glyph(slot, RenderMode);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span> (error != 0)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        FT_Bitmap* ft_bitmap = &amp;Face-&gt;glyph-&gt;bitmap;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        out_glyph_info-&gt;Width = (int)ft_bitmap-&gt;width;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        out_glyph_info-&gt;Height = (<span class="keywordtype">int</span>)ft_bitmap-&gt;rows;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        out_glyph_info-&gt;OffsetX = Face-&gt;glyph-&gt;bitmap_left;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        out_glyph_info-&gt;OffsetY = -Face-&gt;glyph-&gt;bitmap_top;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        out_glyph_info-&gt;AdvanceX = (float)FT_CEIL(slot-&gt;advance.x);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span> ft_bitmap;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordtype">void</span> FreeTypeFont::BlitGlyph(<span class="keyword">const</span> FT_Bitmap* ft_bitmap, uint8_t* dst, uint32_t dst_pitch, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* multiply_table)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        IM_ASSERT(ft_bitmap != NULL);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keyword">const</span> uint32_t w = ft_bitmap-&gt;width;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keyword">const</span> uint32_t h = ft_bitmap-&gt;rows;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keyword">const</span> uint8_t* src = ft_bitmap-&gt;buffer;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keyword">const</span> uint32_t src_pitch = ft_bitmap-&gt;pitch;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">switch</span> (ft_bitmap-&gt;pixel_mode)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">case</span> FT_PIXEL_MODE_GRAY: <span class="comment">// Grayscale image, 1 byte per pixel.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">if</span> (multiply_table == NULL)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="keywordflow">for</span> (uint32_t y = 0; y &lt; h; y++, src += src_pitch, dst += dst_pitch)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        memcpy(dst, src, w);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    <span class="keywordflow">for</span> (uint32_t y = 0; y &lt; h; y++, src += src_pitch, dst += dst_pitch)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        <span class="keywordflow">for</span> (uint32_t x = 0; x &lt; w; x++)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                            dst[x] = multiply_table[src[x]];</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">case</span> FT_PIXEL_MODE_MONO: <span class="comment">// Monochrome image, 1 bit per pixel. The bits in each byte are ordered from MSB to LSB.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                uint8_t color0 = multiply_table ? multiply_table[0] : 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                uint8_t color1 = multiply_table ? multiply_table[255] : 255;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="keywordflow">for</span> (uint32_t y = 0; y &lt; h; y++, src += src_pitch, dst += dst_pitch)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    uint8_t bits = 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    <span class="keyword">const</span> uint8_t* bits_ptr = src;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    <span class="keywordflow">for</span> (uint32_t x = 0; x &lt; w; x++, bits &lt;&lt;= 1)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <span class="keywordflow">if</span> ((x &amp; 7) == 0)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                            bits = *bits_ptr++;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        dst[x] = (bits &amp; 0x80) ? color1 : color0;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            IM_ASSERT(0 &amp;&amp; <span class="stringliteral">&quot;FreeTypeFont::BlitGlyph(): Unknown bitmap pixel mode!&quot;</span>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="preprocessor">#ifndef STB_RECT_PACK_IMPLEMENTATION                        </span><span class="comment">// in case the user already have an implementation in the _same_ compilation unit (e.g. unity builds)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="preprocessor">#ifndef IMGUI_DISABLE_STB_RECT_PACK_IMPLEMENTATION</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">#define STBRP_ASSERT(x)     do { IM_ASSERT(x); } while (0)</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#define STBRP_STATIC</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#define STB_RECT_PACK_IMPLEMENTATION</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">#ifdef IMGUI_STB_RECT_PACK_FILENAME</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#include IMGUI_STB_RECT_PACK_FILENAME</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#include &quot;imstb_rectpack.h&quot;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">struct </span><a class="code" href="structImFontBuildSrcGlyphFT.html">ImFontBuildSrcGlyphFT</a></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;{</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    GlyphInfo           Info;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    uint32_t            Codepoint;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*      BitmapData;         <span class="comment">// Point within one of the dst_tmp_bitmap_buffers[] array</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;};</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keyword">struct </span><a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;{</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    FreeTypeFont        Font;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="structstbrp__rect.html">stbrp_rect</a>*         Rects;              <span class="comment">// Rectangle to pack. We first fill in their size and the packer will give us their position.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">const</span> ImWchar*      SrcRanges;          <span class="comment">// Ranges as requested by user (user is allowed to request too much, e.g. 0x0020..0xFFFF)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">int</span>                 DstIndex;           <span class="comment">// Index into atlas-&gt;Fonts[] and dst_tmp_array[]</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">int</span>                 GlyphsHighest;      <span class="comment">// Highest requested codepoint</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">int</span>                 GlyphsCount;        <span class="comment">// Glyph count (excluding missing glyphs and glyphs already set by an earlier source font)</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="structImBitVector.html">ImBitVector</a>         GlyphsSet;          <span class="comment">// Glyph bit map (random access, 1-bit per codepoint. This will be a maximum of 8KB)</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;ImFontBuildSrcGlyphFT&gt;</a>   GlyphsList;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;};</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">// Temporary data for one destination ImFont* (multiple source fonts can be merged into one destination ImFont)</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keyword">struct </span><a class="code" href="structImFontBuildDstDataFT.html">ImFontBuildDstDataFT</a></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">int</span>                 SrcCount;           <span class="comment">// Number of source fonts targeting this destination font.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">int</span>                 GlyphsHighest;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordtype">int</span>                 GlyphsCount;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="structImBitVector.html">ImBitVector</a>         GlyphsSet;          <span class="comment">// This is used to resolve collision when multiple sources are merged into a same destination font.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;};</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keywordtype">bool</span> ImFontAtlasBuildWithFreeType(FT_Library ft_library, <a class="code" href="structImFontAtlas.html">ImFontAtlas</a>* atlas, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extra_flags)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;{</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    IM_ASSERT(atlas-&gt;ConfigData.Size &gt; 0);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    ImFontAtlasBuildInit(atlas);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// Clear atlas</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    atlas-&gt;TexID = (ImTextureID)NULL;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    atlas-&gt;TexWidth = atlas-&gt;TexHeight = 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    atlas-&gt;TexUvScale = <a class="code" href="structImVec2.html">ImVec2</a>(0.0f, 0.0f);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    atlas-&gt;TexUvWhitePixel = <a class="code" href="structImVec2.html">ImVec2</a>(0.0f, 0.0f);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    atlas-&gt;ClearTexData();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// Temporary storage for building</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;ImFontBuildSrcDataFT&gt;</a> src_tmp_array;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;ImFontBuildDstDataFT&gt;</a> dst_tmp_array;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    src_tmp_array.resize(atlas-&gt;ConfigData.Size);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    dst_tmp_array.resize(atlas-&gt;Fonts.Size);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    memset((<span class="keywordtype">void</span>*)src_tmp_array.Data, 0, (<span class="keywordtype">size_t</span>)src_tmp_array.size_in_bytes());</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    memset((<span class="keywordtype">void</span>*)dst_tmp_array.Data, 0, (<span class="keywordtype">size_t</span>)dst_tmp_array.size_in_bytes());</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// 1. Initialize font loading structure, check font data validity</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; atlas-&gt;ConfigData.Size; src_i++)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <a class="code" href="structImFontConfig.html">ImFontConfig</a>&amp; cfg = atlas-&gt;ConfigData[src_i];</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        FreeTypeFont&amp; font_face = src_tmp.Font;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        IM_ASSERT(cfg.DstFont &amp;&amp; (!cfg.DstFont-&gt;IsLoaded() || cfg.DstFont-&gt;ContainerAtlas == atlas));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// Find index from cfg.DstFont (we allow the user to set cfg.DstFont. Also it makes casual debugging nicer than when storing indices)</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        src_tmp.DstIndex = -1;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> output_i = 0; output_i &lt; atlas-&gt;Fonts.Size &amp;&amp; src_tmp.DstIndex == -1; output_i++)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span> (cfg.DstFont == atlas-&gt;Fonts[output_i])</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                src_tmp.DstIndex = output_i;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        IM_ASSERT(src_tmp.DstIndex != -1); <span class="comment">// cfg.DstFont not pointing within atlas-&gt;Fonts[] array?</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span> (src_tmp.DstIndex == -1)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment">// Load font</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">if</span> (!font_face.InitFont(ft_library, cfg, extra_flags))</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">// Measure highest codepoints</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="structImFontBuildDstDataFT.html">ImFontBuildDstDataFT</a>&amp; dst_tmp = dst_tmp_array[src_tmp.DstIndex];</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        src_tmp.SrcRanges = cfg.GlyphRanges ? cfg.GlyphRanges : atlas-&gt;GetGlyphRangesDefault();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> ImWchar* src_range = src_tmp.SrcRanges; src_range[0] &amp;&amp; src_range[1]; src_range += 2)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            src_tmp.GlyphsHighest = ImMax(src_tmp.GlyphsHighest, (<span class="keywordtype">int</span>)src_range[1]);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        dst_tmp.SrcCount++;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        dst_tmp.GlyphsHighest = ImMax(dst_tmp.GlyphsHighest, src_tmp.GlyphsHighest);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// 2. For every requested codepoint, check for their presence in the font data, and handle redundancy or overlaps between source fonts to avoid unused glyphs.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordtype">int</span> total_glyphs_count = 0;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="structImFontBuildDstDataFT.html">ImFontBuildDstDataFT</a>&amp; dst_tmp = dst_tmp_array[src_tmp.DstIndex];</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        src_tmp.GlyphsSet.Create(src_tmp.GlyphsHighest + 1);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (dst_tmp.GlyphsSet.Storage.empty())</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            dst_tmp.GlyphsSet.Create(dst_tmp.GlyphsHighest + 1);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> ImWchar* src_range = src_tmp.SrcRanges; src_range[0] &amp;&amp; src_range[1]; src_range += 2)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> codepoint = src_range[0]; codepoint &lt;= (int)src_range[1]; codepoint++)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="keywordflow">if</span> (dst_tmp.GlyphsSet.TestBit(codepoint))    <span class="comment">// Don&#39;t overwrite existing glyphs. We could make this an option (e.g. MergeOverwrite)</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                uint32_t glyph_index = FT_Get_Char_Index(src_tmp.Font.Face, codepoint); <span class="comment">// It is actually in the font? (FIXME-OPT: We are not storing the glyph_index..)</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                <span class="keywordflow">if</span> (glyph_index == 0)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="comment">// Add to avail set/counters</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                src_tmp.GlyphsCount++;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                dst_tmp.GlyphsCount++;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                src_tmp.GlyphsSet.SetBit(codepoint);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                dst_tmp.GlyphsSet.SetBit(codepoint);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                total_glyphs_count++;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// 3. Unpack our bit map into a flat list (we now have all the Unicode points that we know are requested _and_ available _and_ not overlapping another)</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        src_tmp.GlyphsList.reserve(src_tmp.GlyphsCount);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        IM_ASSERT(<span class="keyword">sizeof</span>(src_tmp.GlyphsSet.Storage.Data[0]) == <span class="keyword">sizeof</span>(ImU32));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keyword">const</span> ImU32* it_begin = src_tmp.GlyphsSet.Storage.begin();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keyword">const</span> ImU32* it_end = src_tmp.GlyphsSet.Storage.end();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> ImU32* it = it_begin; it &lt; it_end; it++)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="keywordflow">if</span> (ImU32 entries_32 = *it)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="keywordflow">for</span> (ImU32 bit_n = 0; bit_n &lt; 32; bit_n++)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keywordflow">if</span> (entries_32 &amp; ((ImU32)1 &lt;&lt; bit_n))</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <a class="code" href="structImFontBuildSrcGlyphFT.html">ImFontBuildSrcGlyphFT</a> src_glyph;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        memset(&amp;src_glyph, 0, <span class="keyword">sizeof</span>(src_glyph));</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        src_glyph.Codepoint = (ImWchar)(((it - it_begin) &lt;&lt; 5) + bit_n);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        <span class="comment">//src_glyph.GlyphIndex = 0; // FIXME-OPT: We had this info in the previous step and lost it..</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        src_tmp.GlyphsList.push_back(src_glyph);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        src_tmp.GlyphsSet.Clear();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        IM_ASSERT(src_tmp.GlyphsList.Size == src_tmp.GlyphsCount);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dst_i = 0; dst_i &lt; dst_tmp_array.Size; dst_i++)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        dst_tmp_array[dst_i].GlyphsSet.Clear();</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    dst_tmp_array.clear();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// Allocate packing character data and flag packed characters buffer as non-packed (x0=y0=x1=y1=0)</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// (We technically don&#39;t need to zero-clear buf_rects, but let&#39;s do it for the sake of sanity)</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;stbrp_rect&gt;</a> buf_rects;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    buf_rects.resize(total_glyphs_count);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    memset(buf_rects.Data, 0, (<span class="keywordtype">size_t</span>)buf_rects.size_in_bytes());</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// Allocate temporary rasterization data buffers.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// We could not find a way to retrieve accurate glyph size without rendering them.</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// (e.g. slot-&gt;metrics-&gt;width not always matching bitmap-&gt;width, especially considering the Oblique transform)</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// We allocate in chunks of 256 KB to not waste too much extra memory ahead. Hopefully users of FreeType won&#39;t find the temporary allocations.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> BITMAP_BUFFERS_CHUNK_SIZE = 256 * 1024;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">int</span> buf_bitmap_current_used_bytes = 0;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;unsigned char*&gt;</a> buf_bitmap_buffers;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    buf_bitmap_buffers.push_back((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)IM_ALLOC(BITMAP_BUFFERS_CHUNK_SIZE));</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// 4. Gather glyphs sizes so we can pack them in our virtual canvas.</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// 8. Render/rasterize font characters into the texture</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">int</span> total_surface = 0;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordtype">int</span> buf_rects_out_n = 0;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="structImFontConfig.html">ImFontConfig</a>&amp; cfg = atlas-&gt;ConfigData[src_i];</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> (src_tmp.GlyphsCount == 0)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        src_tmp.Rects = &amp;buf_rects[buf_rects_out_n];</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        buf_rects_out_n += src_tmp.GlyphsCount;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">// Compute multiply table if requested</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> multiply_enabled = (cfg.RasterizerMultiply != 1.0f);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> multiply_table[256];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span> (multiply_enabled)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            ImFontAtlasBuildMultiplyCalcLookupTable(multiply_table, cfg.RasterizerMultiply);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">// Gather the sizes of all rectangles we will need to pack</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> padding = atlas-&gt;TexGlyphPadding;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> glyph_i = 0; glyph_i &lt; src_tmp.GlyphsList.Size; glyph_i++)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <a class="code" href="structImFontBuildSrcGlyphFT.html">ImFontBuildSrcGlyphFT</a>&amp; src_glyph = src_tmp.GlyphsList[glyph_i];</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keyword">const</span> FT_Glyph_Metrics* metrics = src_tmp.Font.LoadGlyph(src_glyph.Codepoint);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">if</span> (metrics == NULL)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="comment">// Render glyph into a bitmap (currently held by FreeType)</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keyword">const</span> FT_Bitmap* ft_bitmap = src_tmp.Font.RenderGlyphAndGetInfo(&amp;src_glyph.Info);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            IM_ASSERT(ft_bitmap);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="comment">// Allocate new temporary chunk if needed</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> bitmap_size_in_bytes = src_glyph.Info.Width * src_glyph.Info.Height;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="keywordflow">if</span> (buf_bitmap_current_used_bytes + bitmap_size_in_bytes &gt; BITMAP_BUFFERS_CHUNK_SIZE)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                buf_bitmap_current_used_bytes = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                buf_bitmap_buffers.push_back((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)IM_ALLOC(BITMAP_BUFFERS_CHUNK_SIZE));</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="comment">// Blit rasterized pixels to our temporary buffer and keep a pointer to it.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            src_glyph.BitmapData = buf_bitmap_buffers.back() + buf_bitmap_current_used_bytes;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            buf_bitmap_current_used_bytes += bitmap_size_in_bytes;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            src_tmp.Font.BlitGlyph(ft_bitmap, src_glyph.BitmapData, src_glyph.Info.Width * 1, multiply_enabled ? multiply_table : NULL);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            src_tmp.Rects[glyph_i].w = (stbrp_coord)(src_glyph.Info.Width + padding);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            src_tmp.Rects[glyph_i].h = (stbrp_coord)(src_glyph.Info.Height + padding);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            total_surface += src_tmp.Rects[glyph_i].w * src_tmp.Rects[glyph_i].h;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">// We need a width for the skyline algorithm, any width!</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">// The exact width doesn&#39;t really matter much, but some API/GPU have texture size limitations and increasing width can decrease height.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// User can override TexDesiredWidth and TexGlyphPadding if they wish, otherwise we use a simple heuristic to select the width based on expected surface.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> surface_sqrt = (int)ImSqrt((<span class="keywordtype">float</span>)total_surface) + 1;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    atlas-&gt;TexHeight = 0;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span> (atlas-&gt;TexDesiredWidth &gt; 0)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        atlas-&gt;TexWidth = atlas-&gt;TexDesiredWidth;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        atlas-&gt;TexWidth = (surface_sqrt &gt;= 4096 * 0.7f) ? 4096 : (surface_sqrt &gt;= 2048 * 0.7f) ? 2048 : (surface_sqrt &gt;= 1024 * 0.7f) ? 1024 : 512;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">// 5. Start packing</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// Pack our extra data rectangles first, so it will be on the upper-left corner of our texture (UV will have small values).</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> TEX_HEIGHT_MAX = 1024 * 32;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_nodes_for_packing_algorithm = atlas-&gt;TexWidth - atlas-&gt;TexGlyphPadding;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <a class="code" href="structImVector.html">ImVector&lt;stbrp_node&gt;</a> pack_nodes;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    pack_nodes.resize(num_nodes_for_packing_algorithm);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="structstbrp__context.html">stbrp_context</a> pack_context;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    stbrp_init_target(&amp;pack_context, atlas-&gt;TexWidth, TEX_HEIGHT_MAX, pack_nodes.Data, pack_nodes.Size);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    ImFontAtlasBuildPackCustomRects(atlas, &amp;pack_context);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// 6. Pack each source font. No rendering yet, we are working with rectangles in an infinitely tall texture at this point.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span> (src_tmp.GlyphsCount == 0)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        stbrp_pack_rects(&amp;pack_context, src_tmp.Rects, src_tmp.GlyphsCount);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="comment">// Extend texture height and mark missing glyphs as non-packed so we won&#39;t render them.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="comment">// FIXME: We are not handling packing failure here (would happen if we got off TEX_HEIGHT_MAX or if a single if larger than TexWidth?)</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> glyph_i = 0; glyph_i &lt; src_tmp.GlyphsCount; glyph_i++)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">if</span> (src_tmp.Rects[glyph_i].was_packed)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                atlas-&gt;TexHeight = ImMax(atlas-&gt;TexHeight, src_tmp.Rects[glyph_i].y + src_tmp.Rects[glyph_i].h);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// 7. Allocate texture</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    atlas-&gt;TexHeight = (atlas-&gt;Flags &amp; ImFontAtlasFlags_NoPowerOfTwoHeight) ? (atlas-&gt;TexHeight + 1) : ImUpperPowerOfTwo(atlas-&gt;TexHeight);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    atlas-&gt;TexUvScale = <a class="code" href="structImVec2.html">ImVec2</a>(1.0f / atlas-&gt;TexWidth, 1.0f / atlas-&gt;TexHeight);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    atlas-&gt;TexPixelsAlpha8 = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)IM_ALLOC(atlas-&gt;TexWidth * atlas-&gt;TexHeight);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    memset(atlas-&gt;TexPixelsAlpha8, 0, atlas-&gt;TexWidth * atlas-&gt;TexHeight);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// 8. Copy rasterized font characters back into the main texture</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// 9. Setup ImFont and glyphs for runtime</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>&amp; src_tmp = src_tmp_array[src_i];</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> (src_tmp.GlyphsCount == 0)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">// When merging fonts with MergeMode=true:</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">// - We can have multiple input fonts writing into a same destination font.</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// - dst_font-&gt;ConfigData is != from cfg which is our source configuration.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <a class="code" href="structImFontConfig.html">ImFontConfig</a>&amp; cfg = atlas-&gt;ConfigData[src_i];</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="structImFont.html">ImFont</a>* dst_font = cfg.DstFont;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> ascent = src_tmp.Font.Info.Ascender;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> descent = src_tmp.Font.Info.Descender;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        ImFontAtlasBuildSetupFont(atlas, dst_font, &amp;cfg, ascent, descent);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> font_off_x = cfg.GlyphOffset.x;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> font_off_y = cfg.GlyphOffset.y + IM_ROUND(dst_font-&gt;Ascent);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> padding = atlas-&gt;TexGlyphPadding;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> glyph_i = 0; glyph_i &lt; src_tmp.GlyphsCount; glyph_i++)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <a class="code" href="structImFontBuildSrcGlyphFT.html">ImFontBuildSrcGlyphFT</a>&amp; src_glyph = src_tmp.GlyphsList[glyph_i];</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <a class="code" href="structstbrp__rect.html">stbrp_rect</a>&amp; pack_rect = src_tmp.Rects[glyph_i];</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            IM_ASSERT(pack_rect.was_packed);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">if</span> (pack_rect.w == 0 &amp;&amp; pack_rect.h == 0)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            GlyphInfo&amp; info = src_glyph.Info;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            IM_ASSERT(info.Width + padding &lt;= pack_rect.w);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            IM_ASSERT(info.Height + padding &lt;= pack_rect.h);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> tx = pack_rect.x + padding;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> ty = pack_rect.y + padding;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="comment">// Blit from temporary buffer to final texture</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordtype">size_t</span> blit_src_stride = (size_t)src_glyph.Info.Width;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordtype">size_t</span> blit_dst_stride = (<span class="keywordtype">size_t</span>)atlas-&gt;TexWidth;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* blit_src = src_glyph.BitmapData;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* blit_dst = atlas-&gt;TexPixelsAlpha8 + (ty * blit_dst_stride) + tx;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y = info.Height; y &gt; 0; y--, blit_dst += blit_dst_stride, blit_src += blit_src_stride)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                memcpy(blit_dst, blit_src, blit_src_stride);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="comment">// Register glyph</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordtype">float</span> x0 = info.OffsetX + font_off_x;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordtype">float</span> y0 = info.OffsetY + font_off_y;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordtype">float</span> x1 = x0 + info.Width;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="keywordtype">float</span> y1 = y0 + info.Height;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordtype">float</span> u0 = (tx) / (<span class="keywordtype">float</span>)atlas-&gt;TexWidth;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordtype">float</span> v0 = (ty) / (<span class="keywordtype">float</span>)atlas-&gt;TexHeight;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordtype">float</span> u1 = (tx + info.Width) / (<span class="keywordtype">float</span>)atlas-&gt;TexWidth;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordtype">float</span> v1 = (ty + info.Height) / (<span class="keywordtype">float</span>)atlas-&gt;TexHeight;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            dst_font-&gt;AddGlyph(&amp;cfg, (ImWchar)src_glyph.Codepoint, x0, y0, x1, y1, u0, v0, u1, v1, info.AdvanceX);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        src_tmp.Rects = NULL;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// Cleanup</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> buf_i = 0; buf_i &lt; buf_bitmap_buffers.Size; buf_i++)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        IM_FREE(buf_bitmap_buffers[buf_i]);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> src_i = 0; src_i &lt; src_tmp_array.Size; src_i++)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        src_tmp_array[src_i].~<a class="code" href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a>();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    ImFontAtlasBuildFinish(atlas);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">// Default memory allocators</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>* ImFreeTypeDefaultAllocFunc(<span class="keywordtype">size_t</span> size, <span class="keywordtype">void</span>* user_data)   { IM_UNUSED(user_data); <span class="keywordflow">return</span> IM_ALLOC(size); }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>  ImFreeTypeDefaultFreeFunc(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">void</span>* user_data)      { IM_UNUSED(user_data); IM_FREE(ptr); }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">// Current memory allocators</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>* (*GImFreeTypeAllocFunc)(<span class="keywordtype">size_t</span> size, <span class="keywordtype">void</span>* user_data) = ImFreeTypeDefaultAllocFunc;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keyword">static</span> void  (*GImFreeTypeFreeFunc)(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">void</span>* user_data) = ImFreeTypeDefaultFreeFunc;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>* GImFreeTypeAllocatorUserData = NULL;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">// FreeType memory allocation callbacks</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>* FreeType_Alloc(FT_Memory <span class="comment">/*memory*/</span>, <span class="keywordtype">long</span> size)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;{</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">return</span> GImFreeTypeAllocFunc((<span class="keywordtype">size_t</span>)size, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> FreeType_Free(FT_Memory <span class="comment">/*memory*/</span>, <span class="keywordtype">void</span>* block)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;{</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    GImFreeTypeFreeFunc(block, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span>* FreeType_Realloc(FT_Memory <span class="comment">/*memory*/</span>, <span class="keywordtype">long</span> cur_size, <span class="keywordtype">long</span> new_size, <span class="keywordtype">void</span>* block)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;{</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">// Implement realloc() as we don&#39;t ask user to provide it.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (block == NULL)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">return</span> GImFreeTypeAllocFunc((<span class="keywordtype">size_t</span>)new_size, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (new_size == 0)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        GImFreeTypeFreeFunc(block, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">if</span> (new_size &gt; cur_size)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordtype">void</span>* new_block = GImFreeTypeAllocFunc((<span class="keywordtype">size_t</span>)new_size, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        memcpy(new_block, block, (<span class="keywordtype">size_t</span>)cur_size);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        GImFreeTypeFreeFunc(block, GImFreeTypeAllocatorUserData);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">return</span> new_block;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">return</span> block;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordtype">bool</span> ImGuiFreeType::BuildFontAtlas(<a class="code" href="structImFontAtlas.html">ImFontAtlas</a>* atlas, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extra_flags)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// FreeType memory management: https://www.freetype.org/freetype2/docs/design/design-4.html</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    FT_MemoryRec_ memory_rec = {};</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    memory_rec.user = NULL;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    memory_rec.alloc = &amp;FreeType_Alloc;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    memory_rec.free = &amp;FreeType_Free;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    memory_rec.realloc = &amp;FreeType_Realloc;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="comment">// https://www.freetype.org/freetype2/docs/reference/ft2-module_management.html#FT_New_Library</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    FT_Library ft_library;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    FT_Error error = FT_New_Library(&amp;memory_rec, &amp;ft_library);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span> (error != 0)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">// If you don&#39;t call FT_Add_Default_Modules() the rest of code may work, but FreeType won&#39;t use our custom allocator.</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    FT_Add_Default_Modules(ft_library);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">bool</span> ret = ImFontAtlasBuildWithFreeType(ft_library, atlas, extra_flags);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    FT_Done_Library(ft_library);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keywordtype">void</span> ImGuiFreeType::SetAllocatorFunctions(<span class="keywordtype">void</span>* (*alloc_func)(<span class="keywordtype">size_t</span> sz, <span class="keywordtype">void</span>* user_data), <span class="keywordtype">void</span> (*free_func)(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">void</span>* user_data), <span class="keywordtype">void</span>* user_data)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;{</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    GImFreeTypeAllocFunc = alloc_func;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    GImFreeTypeFreeFunc = free_func;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    GImFreeTypeAllocatorUserData = user_data;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="ttc" id="agroup__gtc__type__precision_html_ga822ca53a9ad412504532838906276a99"><div class="ttname"><a href="group__gtc__type__precision.html#ga822ca53a9ad412504532838906276a99">glm::uint32_t</a></div><div class="ttdeci">uint32 uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="fwd_8hpp_source.html#l00131">fwd.hpp:131</a></div></div>
<div class="ttc" id="astructImBitVector_html"><div class="ttname"><a href="structImBitVector.html">ImBitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imgui__internal_8h_source.html#l00518">imgui_internal.h:519</a></div></div>
<div class="ttc" id="astructImFontAtlas_html"><div class="ttname"><a href="structImFontAtlas.html">ImFontAtlas</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imgui_8h_source.html#l02691">imgui.h:2692</a></div></div>
<div class="ttc" id="astructImFontBuildDstDataFT_html"><div class="ttname"><a href="structImFontBuildDstDataFT.html">ImFontBuildDstDataFT</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2misc_2freetype_2imgui__freetype_8cpp_source.html#l00373">imgui_freetype.cpp:374</a></div></div>
<div class="ttc" id="astructImFontBuildSrcDataFT_html"><div class="ttname"><a href="structImFontBuildSrcDataFT.html">ImFontBuildSrcDataFT</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2misc_2freetype_2imgui__freetype_8cpp_source.html#l00360">imgui_freetype.cpp:361</a></div></div>
<div class="ttc" id="astructImFontBuildSrcGlyphFT_html"><div class="ttname"><a href="structImFontBuildSrcGlyphFT.html">ImFontBuildSrcGlyphFT</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2misc_2freetype_2imgui__freetype_8cpp_source.html#l00351">imgui_freetype.cpp:352</a></div></div>
<div class="ttc" id="astructImFontConfig_html"><div class="ttname"><a href="structImFontConfig.html">ImFontConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imgui_8h_source.html#l02597">imgui.h:2598</a></div></div>
<div class="ttc" id="astructImFont_html"><div class="ttname"><a href="structImFont.html">ImFont</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imgui_8h_source.html#l02790">imgui.h:2791</a></div></div>
<div class="ttc" id="astructImVec2_html"><div class="ttname"><a href="structImVec2.html">ImVec2</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imgui_8h_source.html#l00234">imgui.h:235</a></div></div>
<div class="ttc" id="astructImVector_html"><div class="ttname"><a href="structImVector.html">ImVector&lt; ImFontBuildSrcGlyphFT &gt;</a></div></div>
<div class="ttc" id="astructstbrp__context_html"><div class="ttname"><a href="structstbrp__context.html">stbrp_context</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imstb__rectpack_8h_source.html#l00181">imstb_rectpack.h:182</a></div></div>
<div class="ttc" id="astructstbrp__rect_html"><div class="ttname"><a href="structstbrp__rect.html">stbrp_rect</a></div><div class="ttdef"><b>Definition:</b> <a href="imgui_2imstb__rectpack_8h_source.html#l00115">imstb_rectpack.h:116</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
